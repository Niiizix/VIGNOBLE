<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documents - Marlowe Vineyard Intranet</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <a href="../index.html" class="logo">
                <i class="fas fa-shield-alt"></i>
                Marlowe Intranet
            </a>
            <ul class="nav-menu">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="inventaire.html">Inventaire</a></li>
                <li><a href="#commandes">Commandes</a></li>
                <li><a href="documents.html" class="active">Documents</a></li>
                <li><a href="configuration.html">Configuration</a></li>
                <li><a href="#" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> D√©connexion
                </a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero hero-intranet">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        
        <div class="hero-content">
            <h1>G√©n√©ration de Documents</h1>
            <p class="subtitle">Cr√©ation automatis√©e de documents</p>
            <p>G√©n√©rez rapidement vos devis, factures et autres documents commerciaux avec calculs automatiques.</p>
        </div>
    </section>

    <!-- Status Debug -->
    <section style="background: #f8f9fa; padding: 2rem; text-align: center;">
        <div id="debugStatus" style="max-width: 800px; margin: 0 auto;">
            <h3>üîß Status Syst√®me</h3>
            <div id="pdfLibStatus">‚è≥ V√©rification PDF-lib...</div>
            <div id="templateStatus">‚è≥ V√©rification template...</div>
            <div id="scriptsStatus">‚è≥ V√©rification scripts...</div>
        </div>
    </section>

    <!-- Documents Section -->
    <section class="documents-section">
        <div class="documents-container">
            
            <!-- Documents Clients -->
            <div class="document-category">
                <div class="category-header">
                    <h2><i class="fas fa-user-tie"></i> Documents Clients</h2>
                    <p>Cr√©ez tous vos documents commerciaux destin√©s aux clients</p>
                </div>
                
                <div class="documents-grid">
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h3>Devis Client</h3>
                        <p>G√©n√©rez un devis personnalis√© avec calculs automatiques des totaux HT/TTC et envoi Discord</p>
                        <button class="cta-button btn-success document-btn" id="testDevisBtn">
                            <i class="fas fa-plus"></i> Test Devis
                        </button>
                        <div id="devisStatus" style="margin-top: 10px; font-size: 12px; color: #6c757d;"></div>
                    </div>

                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3>Facture</h3>
                        <p>√âmettez une facture apr√®s commande avec d√©tail des produits et montants</p>
                        <button class="cta-button btn-primary document-btn" data-document="facture">
                            <i class="fas fa-plus"></i> Cr√©er une Facture
                        </button>
                    </div>

                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <h3>Bon de Livraison</h3>
                        <p>Pr√©parez les bons de livraison pour les exp√©ditions et livraisons clients</p>
                        <button class="cta-button btn-info document-btn" data-document="livraison">
                            <i class="fas fa-plus"></i> Cr√©er un Bon
                        </button>
                    </div>

                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <h3>Contrat de Visite</h3>
                        <p>Formalisez les r√©servations de visites avec conditions et tarification</p>
                        <button class="cta-button btn-purple document-btn" data-document="visite">
                            <i class="fas fa-plus"></i> Cr√©er un Contrat
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Marlowe Vineyard - Intranet Priv√© | Acc√®s Restreint</p>
    </footer>

    <script src="../script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DIAGNOSTIC MARLOWE DOCUMENTS ===');
            
            // Test 1: V√©rifier PDF-lib
            const pdfLibEl = document.getElementById('pdfLibStatus');
            
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js';
            script.onload = function() {
                if (typeof PDFLib !== 'undefined') {
                    pdfLibEl.innerHTML = '‚úÖ PDF-lib charg√© avec succ√®s';
                    pdfLibEl.style.color = '#28a745';
                    console.log('‚úÖ PDF-lib disponible');
                    testTemplate();
                } else {
                    pdfLibEl.innerHTML = '‚ùå PDF-lib charg√© mais non disponible';
                    pdfLibEl.style.color = '#dc3545';
                    console.log('‚ùå PDF-lib charg√© mais PDFLib undefined');
                }
            };
            script.onerror = function() {
                pdfLibEl.innerHTML = '‚ùå Impossible de charger PDF-lib';
                pdfLibEl.style.color = '#dc3545';
                console.log('‚ùå Erreur chargement PDF-lib');
            };
            document.head.appendChild(script);
            
            // Test 2: V√©rifier template
            async function testTemplate() {
                const templateEl = document.getElementById('templateStatus');
                
                try {
                    const response = await fetch('../assets/template-devis.pdf');
                    if (response.ok) {
                        const blob = await response.blob();
                        templateEl.innerHTML = `‚úÖ Template trouv√© (${blob.size} bytes)`;
                        templateEl.style.color = '#28a745';
                        console.log('‚úÖ Template accessible');
                        
                        // Test de chargement PDF
                        try {
                            const arrayBuffer = await blob.arrayBuffer();
                            const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                            templateEl.innerHTML = `‚úÖ Template PDF valide (${pdfDoc.getPages().length} page(s))`;
                            console.log('‚úÖ Template PDF parse avec succ√®s');
                            enableDevisGeneration();
                        } catch (error) {
                            templateEl.innerHTML = `‚ö†Ô∏è Template trouv√© mais erreur parsing: ${error.message}`;
                            templateEl.style.color = '#ffc107';
                            console.log('‚ö†Ô∏è Erreur parsing PDF:', error);
                        }
                    } else {
                        templateEl.innerHTML = `‚ùå Template non trouv√© (${response.status})`;
                        templateEl.style.color = '#dc3545';
                        console.log('‚ùå Template non accessible');
                    }
                } catch (error) {
                    templateEl.innerHTML = `‚ùå Erreur acc√®s template: ${error.message}`;
                    templateEl.style.color = '#dc3545';
                    console.log('‚ùå Erreur acc√®s template:', error);
                }
            }
            
            // Test 3: V√©rifier scripts
            const scriptsEl = document.getElementById('scriptsStatus');
            if (typeof notify !== 'undefined') {
                scriptsEl.innerHTML = '‚úÖ Scripts Marlowe charg√©s';
                scriptsEl.style.color = '#28a745';
                console.log('‚úÖ Scripts principaux OK');
            } else {
                scriptsEl.innerHTML = '‚ùå Scripts Marlowe manquants';
                scriptsEl.style.color = '#dc3545';
                console.log('‚ùå Scripts principaux manquants');
            }
            
            function enableDevisGeneration() {
                const devisBtn = document.getElementById('testDevisBtn');
                const devisStatus = document.getElementById('devisStatus');
                
                devisBtn.onclick = function() {
                    devisStatus.innerHTML = 'üéâ Syst√®me op√©rationnel ! G√©n√©ration PDF possible.';
                    devisStatus.style.color = '#28a745';
                    
                    if (typeof notify !== 'undefined') {
                        notify.success('Syst√®me OK', 'Toutes les v√©rifications pass√©es ! Vous pouvez g√©n√©rer des PDF.');
                    } else {
                        alert('Syst√®me OK ! Toutes les v√©rifications pass√©es.');
                    }
                };
                
                devisBtn.innerHTML = '<i class="fas fa-check"></i> Syst√®me OK - Cr√©er Devis';
                devisBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
            }
            
            // Gestion d√©connexion
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                    window.location.href = '../index.html';
                }
            });
            
            console.log('=== FIN DIAGNOSTIC ===');
        });
    </script>
</body>
</html>
